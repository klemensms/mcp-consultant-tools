# PowerPlatform/Dataverse Configuration
# Copy this file to .env and fill in your actual values

# Your PowerPlatform environment URL
# Example: https://yourorg.crm.dynamics.com or https://yourorg.crm4.dynamics.com
POWERPLATFORM_URL=https://yourorg.crm.dynamics.com

# Azure AD App Registration Details
POWERPLATFORM_CLIENT_ID=your-client-id-here
POWERPLATFORM_TENANT_ID=your-tenant-id-here

# =============================================================================
# PowerPlatform Authentication Mode (v23+)
# =============================================================================
# Two authentication modes are supported:
#
# 1. SERVICE PRINCIPAL (server-to-server, recommended for automation)
#    - Set POWERPLATFORM_CLIENT_SECRET below
#    - Uses app identity for all operations
#    - Best for: CI/CD, scheduled tasks, shared services
#
# 2. INTERACTIVE USER AUTH (browser SSO, new in v23)
#    - Do NOT set POWERPLATFORM_CLIENT_SECRET (leave empty or comment out)
#    - Opens browser for Microsoft Entra ID sign-in
#    - User's Dynamics security roles apply
#    - Best for: Individual users, desktop apps, debugging
#
# App registration requirements for interactive auth:
#   - Enable "Allow public client flows" in Azure Portal
#   - Add http://localhost as redirect URI (Mobile/Desktop platform)
#   - Grant "offline_access" delegated permission for token refresh
# =============================================================================

# Client Secret (OPTIONAL - omit for interactive browser auth)
# If set: Uses service principal (app) authentication
# If NOT set: Opens browser for interactive user sign-in
POWERPLATFORM_CLIENT_SECRET=your-client-secret-here

# =============================================================================
# PowerPlatform Security Model (v21+)
# =============================================================================
# Customization security: Package-based (no flag required)
#   Install @mcp-consultant-tools/powerplatform-customization to enable schema changes
#
# Data CRUD security: Granular flags (required)
#   Install @mcp-consultant-tools/powerplatform-data, then enable specific operations:

# Default solution to add customizations to (optional - used by customization package)
POWERPLATFORM_DEFAULT_SOLUTION=YourSolutionName

# Data CRUD Operations (Optional - defaults to disabled)
# ⚠️ WARNING: These allow data modifications - use with caution
POWERPLATFORM_ENABLE_CREATE=false   # Enable record creation
POWERPLATFORM_ENABLE_UPDATE=false   # Enable record updates
POWERPLATFORM_ENABLE_DELETE=false   # Enable record deletion (most dangerous)

# =============================================================================
# Azure DevOps Configuration (Optional)
# Required only if using Azure DevOps wiki and work item features

# Azure DevOps organization name (from https://dev.azure.com/<organization>)
AZUREDEVOPS_ORGANIZATION=your-organization-name

# Personal Access Token (PAT) with Read access to wikis and work items
# Create at: https://dev.azure.com/<organization>/_usersSettings/tokens
AZUREDEVOPS_PAT=your-personal-access-token-here

# Comma-separated list of allowed projects
AZUREDEVOPS_PROJECTS=Project1,Project2

# API version (default: 7.1)
AZUREDEVOPS_API_VERSION=7.1

# Feature flags (default: false)
AZUREDEVOPS_ENABLE_WORK_ITEM_WRITE=false
AZUREDEVOPS_ENABLE_WORK_ITEM_DELETE=false
AZUREDEVOPS_ENABLE_WIKI_WRITE=false

# =============================================================================
# Figma Configuration (Optional)
# =============================================================================

# Figma Personal Access Token (PAT)
# Generate at: https://www.figma.com/developers/api#authentication
# Required if not using OAuth
FIGMA_API_KEY=your_figma_personal_access_token_here

# Figma OAuth Token (Alternative to API Key)
# Use this if authenticating via OAuth instead of PAT
FIGMA_OAUTH_TOKEN=

# Use OAuth Authentication (true/false)
# Set to "true" if using FIGMA_OAUTH_TOKEN instead of FIGMA_API_KEY
FIGMA_USE_OAUTH=false

# =============================================================================
# Azure Application Insights Configuration (Optional)
# =============================================================================

# Authentication method: 'entra-id' (recommended) or 'api-key'
APPINSIGHTS_AUTH_METHOD=entra-id

# For Entra ID authentication (recommended - higher rate limits)
APPINSIGHTS_TENANT_ID=your-azure-tenant-id
APPINSIGHTS_CLIENT_ID=your-azure-app-client-id
APPINSIGHTS_CLIENT_SECRET=your-azure-app-client-secret

# Application Insights resources configuration (JSON array)
# Each resource needs: id, name, appId, active (true/false)
APPINSIGHTS_RESOURCES=[{"id":"prod-api","name":"Production API","appId":"your-app-id","active":true}]

# Alternative: Single resource configuration (fallback)
APPINSIGHTS_APP_ID=your-app-id
APPINSIGHTS_API_KEY=your-api-key

# =============================================================================
# Azure SQL Database Configuration (Optional)
# =============================================================================

# =============================================================================
# Multi-Server Configuration (RECOMMENDED - New Format)
# =============================================================================
# Configure multiple SQL servers with different credentials per server.
# Supports multiple databases per server with active/inactive flags.
# If databases[] is empty, you can access all databases on that server.
#
# Example with multiple servers and databases:
AZURE_SQL_SERVERS='[
  {
    "id": "prod-sql",
    "name": "Production SQL Server",
    "server": "prod-server.database.windows.net",
    "port": 1433,
    "active": true,
    "databases": [
      {
        "name": "AppDB",
        "active": true,
        "description": "Main application database"
      },
      {
        "name": "AnalyticsDB",
        "active": true,
        "description": "Analytics database"
      }
    ],
    "username": "mcp_readonly",
    "password": "SecurePassword123!",
    "useAzureAd": false,
    "description": "Production SQL Server"
  },
  {
    "id": "dev-sql",
    "name": "Development SQL Server",
    "server": "dev-server.database.windows.net",
    "port": 1433,
    "active": true,
    "databases": [],
    "useAzureAd": true,
    "azureAdClientId": "your-azure-app-client-id",
    "azureAdClientSecret": "your-azure-app-client-secret",
    "azureAdTenantId": "your-azure-tenant-id",
    "description": "Dev server with Azure AD auth - empty databases[] allows access to all databases"
  }
]'

# =============================================================================
# Legacy Single-Server Configuration (Backward Compatibility)
# =============================================================================
# If AZURE_SQL_SERVERS is not set, these variables will be used to configure
# a single server with a single database (ID: "default").
#
# Azure SQL Server name
AZURE_SQL_SERVER=myserver.database.windows.net

# Database name
AZURE_SQL_DATABASE=mydatabase

# SQL Server port (default: 1433)
AZURE_SQL_PORT=1433

# SQL Authentication (username/password)
AZURE_SQL_USERNAME=mcp_readonly
AZURE_SQL_PASSWORD=SecurePassword123!

# Azure AD Authentication (set AZURE_SQL_USE_AZURE_AD=true to enable)
AZURE_SQL_USE_AZURE_AD=false
AZURE_SQL_CLIENT_ID=your-azure-app-client-id
AZURE_SQL_CLIENT_SECRET=your-azure-app-client-secret
AZURE_SQL_TENANT_ID=your-azure-tenant-id

# =============================================================================
# SQL Query Safety Limits (Applies to All Servers)
# =============================================================================
# Query timeout in milliseconds (default: 30000 = 30 seconds)
AZURE_SQL_QUERY_TIMEOUT=30000

# Maximum rows returned per query (default: 1000)
AZURE_SQL_MAX_RESULT_ROWS=1000

# Connection timeout in milliseconds (default: 15000 = 15 seconds)
AZURE_SQL_CONNECTION_TIMEOUT=15000

# =============================================================================
# SQL Connection Pool Settings (Applies to All Servers)
# =============================================================================
# Minimum pool connections per database (default: 0)
AZURE_SQL_POOL_MIN=0

# Maximum pool connections per database (default: 10)
AZURE_SQL_POOL_MAX=10

# =============================================================================
# Azure Log Analytics Workspace Configuration (Optional)
# =============================================================================

# Authentication method: 'entra-id' (recommended) or 'api-key'
LOGANALYTICS_AUTH_METHOD=entra-id

# For Entra ID authentication (recommended - higher rate limits)
# Note: You can reuse the same credentials from Application Insights if using the same app registration
LOGANALYTICS_TENANT_ID=your-azure-tenant-id
LOGANALYTICS_CLIENT_ID=your-azure-app-client-id
LOGANALYTICS_CLIENT_SECRET=your-azure-app-client-secret

# Log Analytics workspaces configuration (JSON array)
# Each workspace needs: id, name, workspaceId, active (true/false)
LOGANALYTICS_RESOURCES=[{"id":"prod-functions","name":"Production Functions","workspaceId":"12345678-1234-1234-1234-123456789012","active":true}]

# Alternative: Single workspace configuration (fallback)
LOGANALYTICS_WORKSPACE_ID=12345678-1234-1234-1234-123456789012
LOGANALYTICS_API_KEY=your-api-key-if-using-api-key-auth

# =============================================================================
# Azure Service Bus Configuration (Optional)
# =============================================================================

# Authentication method: 'entra-id' (recommended) or 'connection-string'
SERVICEBUS_AUTH_METHOD=entra-id

# For Entra ID authentication (recommended - better security)
# Note: You can reuse the same credentials from Application Insights if using the same app registration
SERVICEBUS_TENANT_ID=your-azure-tenant-id
SERVICEBUS_CLIENT_ID=your-azure-app-client-id
SERVICEBUS_CLIENT_SECRET=your-azure-app-client-secret

# Service Bus namespaces configuration (JSON array)
# Each namespace needs: id, name, namespace, active (true/false)
SERVICEBUS_RESOURCES=[{"id":"prod","name":"Production Service Bus","namespace":"prod-namespace.servicebus.windows.net","active":true}]

# Alternative: Single namespace configuration (fallback)
SERVICEBUS_NAMESPACE=prod-namespace.servicebus.windows.net
SERVICEBUS_CONNECTION_STRING=Endpoint=sb://prod-namespace.servicebus.windows.net/;SharedAccessKeyName=RootManageSharedAccessKey;SharedAccessKey=your-key-here

# =============================================================================
# Service Bus Security & Performance Options (Optional)
# =============================================================================

# Sanitize message bodies and properties (default: false)
# Set to "true" when working with production data containing PII
SERVICEBUS_SANITIZE_MESSAGES=false

# Maximum messages to peek in one operation (default: 100)
SERVICEBUS_MAX_PEEK_MESSAGES=100

# Maximum messages to search (default: 500)
SERVICEBUS_MAX_SEARCH_MESSAGES=500

# Peek operation timeout in milliseconds (default: 30000 = 30 seconds)
SERVICEBUS_PEEK_TIMEOUT=30000

# Retry settings for transient failures
SERVICEBUS_RETRY_MAX_ATTEMPTS=3
SERVICEBUS_RETRY_DELAY=1000

# Queue list cache time-to-live in seconds (default: 300 = 5 minutes)
SERVICEBUS_CACHE_QUEUE_LIST_TTL=300

# =============================================================================
# GitHub Enterprise Configuration (Optional)
# =============================================================================

# GitHub Enterprise URL (e.g., https://github.yourcompany.com)
GHE_URL=https://github.yourcompany.com

# Personal Access Token (PAT) - recommended authentication method
GHE_PAT=ghp_your_personal_access_token_here

# Authentication method: 'pat' (recommended) or 'github-app'
GHE_AUTH_METHOD=pat

# Repository configuration (JSON array)
# Each repo needs: id, owner, repo, defaultBranch (optional), active (true/false)
GHE_REPOS=[{"id":"plugin-core","owner":"yourorg","repo":"PluginCore","defaultBranch":"release/9.0","active":true}]

# Caching configuration
GHE_ENABLE_CACHE=true
GHE_CACHE_TTL=300

# Write permissions (default: false)
GHE_ENABLE_WRITE=false
GHE_ENABLE_CREATE=false

# =============================================================================
# SharePoint Online Configuration (Optional)
# =============================================================================

# Authentication (Entra ID / OAuth 2.0)
# Note: Can reuse Application Insights/Log Analytics credentials if using same app registration
SHAREPOINT_TENANT_ID=your-azure-tenant-id
SHAREPOINT_CLIENT_ID=your-azure-app-client-id
SHAREPOINT_CLIENT_SECRET=your-azure-app-client-secret

# Multi-site configuration (JSON array)
# Each site needs: id, name, siteUrl, active (true/false), description (optional)
SHAREPOINT_SITES=[{"id":"intranet","name":"Company Intranet","siteUrl":"https://yourtenant.sharepoint.com/sites/intranet","active":true}]

# Alternative: Single-site configuration (fallback)
SHAREPOINT_SITE_URL=https://yourtenant.sharepoint.com/sites/intranet

# =============================================================================
# SharePoint Optional Configuration
# =============================================================================

# Cache time-to-live in seconds (default: 300 = 5 minutes)
SHAREPOINT_CACHE_TTL=300

# Maximum search results (default: 100)
SHAREPOINT_MAX_SEARCH_RESULTS=100

# Search timeout in milliseconds (default: 30000 = 30 seconds)
SHAREPOINT_SEARCH_TIMEOUT=30000

# =============================================================================
# REST API Configuration (Optional)
# =============================================================================
# Generic REST API testing with OAuth2 client credentials support

# REQUIRED: Base URL for all REST API requests
REST_BASE_URL=https://your-api.example.com/api

# OAuth2 Client Credentials Flow (Recommended for Azure/Entra ID protected APIs)
# This enables automatic JWT token acquisition and caching
OAUTH2_TOKEN_URL=https://login.microsoftonline.com/{tenant-id}/oauth2/v2.0/token
OAUTH2_CLIENT_ID=your-azure-app-client-id
OAUTH2_CLIENT_SECRET=your-azure-app-client-secret
OAUTH2_SCOPE=api://your-app-id/.default
OAUTH2_GRANT_TYPE=client_credentials

# Alternative 1: Static Bearer Token (for pre-acquired tokens)
# AUTH_BEARER=your-pre-acquired-jwt-token

# Alternative 2: Basic Authentication
# AUTH_BASIC_USERNAME=your-username
# AUTH_BASIC_PASSWORD=your-password

# Alternative 3: API Key Authentication
# AUTH_APIKEY_HEADER_NAME=X-Api-Key
# AUTH_APIKEY_VALUE=your-api-key

# =============================================================================
# REST API Optional Configuration
# =============================================================================

# Maximum response size in bytes (default: 10000 = 10KB)
REST_RESPONSE_SIZE_LIMIT=10000

# Enable SSL certificate verification (default: true)
# Set to "false" only for development with self-signed certs
REST_ENABLE_SSL_VERIFY=true

# Request timeout in milliseconds (default: 30000 = 30 seconds)
REST_TIMEOUT=30000

# Custom headers (prefix with HEADER_)
# These will be added to all requests
HEADER_Accept=application/json
# HEADER_X-Custom-Header=custom-value

# =============================================================================
# REST API Discovery Configuration (Optional)
# =============================================================================
# Enables endpoint discovery and schema lookup via OpenAPI/Swagger
# Reduces AI agent discovery overhead - all endpoints auto-discovered

# OpenAPI/Swagger URL
# -----------------------------------------------------------------------------
# Point to your API's OpenAPI spec - endpoints and schemas are auto-discovered
# For DAB, this is typically your base URL + "/swagger/v1/swagger.json"
# Benefits: Always up-to-date, zero maintenance, works with 80+ tables automatically
REST_OPENAPI_URL=https://your-dab-api.azurewebsites.net/swagger/v1/swagger.json

# =============================================================================
# Azure AD B2C Configuration (Optional)
# =============================================================================
# User management for Azure AD B2C tenants via Microsoft Graph API

# B2C Tenant ID (GUID or domain like contoso.onmicrosoft.com)
AZURE_B2C_TENANT_ID=your-tenant.onmicrosoft.com

# App Registration Client ID
AZURE_B2C_CLIENT_ID=12345678-1234-1234-1234-123456789012

# App Registration Client Secret
AZURE_B2C_CLIENT_SECRET=your-client-secret

# =============================================================================
# Azure B2C Security Flags (Optional - all default to false)
# =============================================================================
# Enable only the operations you need - read-only is always enabled

# Enable password reset and force change operations
# Requires: App must have "User Administrator" role
AZURE_B2C_ENABLE_PASSWORD_RESET=false

# Enable user creation (new accounts)
AZURE_B2C_ENABLE_USER_CREATE=false

# Enable user profile updates (modify existing users)
AZURE_B2C_ENABLE_USER_UPDATE=false

# Enable user deletion (DANGEROUS - irreversible!)
# Only enable in controlled environments
AZURE_B2C_ENABLE_USER_DELETE=false

# =============================================================================
# Azure B2C Optional Settings
# =============================================================================

# Maximum users/groups per request (default: 100)
AZURE_B2C_MAX_RESULTS=100
