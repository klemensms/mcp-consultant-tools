# Release v21.0.0-beta.1

**Release Date:** TBD
**Type:** Major Release (Breaking Changes)
**Status:** Beta Testing

## Overview

Version 21.0.0 simplifies the PowerPlatform security model by removing environment flag requirements and relying solely on package selection for security isolation. User testing confirms package isolation already provides sufficient security boundary.

## Breaking Changes

### PowerPlatform Security Model Simplification

**OLD (v16-20):** Two-layer security (package + environment flags)
```bash
# Both required
npm install @mcp-consultant-tools/powerplatform-customization
POWERPLATFORM_ENABLE_CUSTOMIZATION=true
```

**NEW (v21+):** Package-only security
```bash
# Just package installation
npm install @mcp-consultant-tools/powerplatform-customization
# No flags needed - installation = explicit intent
```

**Removed Environment Flags:**
- `POWERPLATFORM_ENABLE_CUSTOMIZATION` (powerplatform-customization package)

**Retained Environment Flags (Still Required):**
- `POWERPLATFORM_ENABLE_CREATE` (powerplatform-data package) - Granular control retained
- `POWERPLATFORM_ENABLE_UPDATE` (powerplatform-data package) - Granular control retained
- `POWERPLATFORM_ENABLE_DELETE` (powerplatform-data package) - Granular control retained

**Migration Required:**
1. Review package installations across all environments
2. Uninstall `powerplatform-customization` from production
3. Remove `POWERPLATFORM_ENABLE_CUSTOMIZATION` flag from `.env` files (optional cleanup)
4. **Keep data flags**: `POWERPLATFORM_ENABLE_CREATE/UPDATE/DELETE` are still required for data operations

**See:** [Migration Guide](/docs/MIGRATION_v21.md) for complete instructions.

### Packages Affected

- `@mcp-consultant-tools/powerplatform-customization` - No longer checks `POWERPLATFORM_ENABLE_CUSTOMIZATION`
- `@mcp-consultant-tools/powerplatform-data` - **Still requires** `POWERPLATFORM_ENABLE_CREATE/UPDATE/DELETE` flags
- `@mcp-consultant-tools/meta` - Updated comments for customization package

**Backward Compatibility:**
- Customization flag will be ignored (no errors)
- Data flags still required and checked (breaking if removed)
- No code changes required for users
- Configuration files will continue to work

## Why This Change?

**Problem:** The customization flag added redundant complexity on top of package isolation.

**Solution:** Remove customization flag, rely on package selection. Keep data flags for granular control.

**Benefits:**
- Simpler configuration for customization operations (no flag to set)
- Clearer mental model for schema changes (install package = grant access)
- Granular control retained for data operations (CREATE/UPDATE/DELETE flags preserved)
- Package isolation already proven through testing

**Security maintained:**
- Schema changes: Package installation = explicit intent
- Data operations: Granular flags provide fine-tuned control per operation type
- Production environments should only install the read-only `powerplatform` package

## Beta Testing Configuration

### Test 1: Read-Only Package (Production-Safe)
```json
{
  "mcpServers": {
    "powerplatform": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/powerplatform@beta"],
      "env": {
        "POWERPLATFORM_URL": "https://dev-environment.crm.dynamics.com",
        "POWERPLATFORM_CLIENT_ID": "your-client-id",
        "POWERPLATFORM_CLIENT_SECRET": "your-client-secret",
        "POWERPLATFORM_TENANT_ID": "your-tenant-id"
      }
    }
  }
}
```

**Expected:** Read-only access works. No customization or data operations available.

### Test 2: Customization Package (No Flags)
```json
{
  "mcpServers": {
    "powerplatform-customization": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/powerplatform-customization@beta"],
      "env": {
        "POWERPLATFORM_URL": "https://dev-environment.crm.dynamics.com",
        "POWERPLATFORM_CLIENT_ID": "your-client-id",
        "POWERPLATFORM_CLIENT_SECRET": "your-client-secret",
        "POWERPLATFORM_TENANT_ID": "your-tenant-id",
        "POWERPLATFORM_DEFAULT_SOLUTION": "TestSolution"
      }
    }
  }
}
```

**Expected:** All customization tools immediately available (no flag needed).

### Test 3: Data Package (With Granular Flags)
```json
{
  "mcpServers": {
    "powerplatform-data": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/powerplatform-data@beta"],
      "env": {
        "POWERPLATFORM_URL": "https://dev-environment.crm.dynamics.com",
        "POWERPLATFORM_CLIENT_ID": "your-client-id",
        "POWERPLATFORM_CLIENT_SECRET": "your-client-secret",
        "POWERPLATFORM_TENANT_ID": "your-tenant-id",
        "POWERPLATFORM_ENABLE_CREATE": "true",
        "POWERPLATFORM_ENABLE_UPDATE": "true",
        "POWERPLATFORM_ENABLE_DELETE": "true"
      }
    }
  }
}
```

**Expected:** CRUD tools available based on flags set. All operations work with flags enabled.

### Test 4: Meta Package (All Integrations with Data Flags)
```json
{
  "mcpServers": {
    "mcp-consultant-tools": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/meta@beta"],
      "env": {
        "POWERPLATFORM_URL": "https://dev-environment.crm.dynamics.com",
        "POWERPLATFORM_CLIENT_ID": "your-client-id",
        "POWERPLATFORM_CLIENT_SECRET": "your-client-secret",
        "POWERPLATFORM_TENANT_ID": "your-tenant-id",
        "POWERPLATFORM_ENABLE_CREATE": "true",
        "POWERPLATFORM_ENABLE_UPDATE": "true",
        "POWERPLATFORM_ENABLE_DELETE": "true"
      }
    }
  }
}
```

**Expected:** All PowerPlatform tools available (read + customization + data with flags).

## Beta Testing Checklist

**Package Isolation:**
- [ ] Verify `powerplatform` package only exposes read-only tools
- [ ] Verify `powerplatform-customization` tools work without CUSTOMIZATION flag
- [ ] Verify `powerplatform-data` tools require CREATE/UPDATE/DELETE flags
- [ ] Verify delete operation still requires `confirm: true`

**Migration:**
- [ ] Test existing v20 config with all flags (should work)
- [ ] Test v21 config without CUSTOMIZATION flag (customization should work)
- [ ] Test v21 config without data flags (data operations should fail with clear error)
- [ ] Verify granular control: CREATE=true but DELETE=false works as expected

**Documentation:**
- [ ] Review updated README.md
- [ ] Review updated CLAUDE.md
- [ ] Review migration guide
- [ ] Review updated user documentation

**Security:**
- [ ] Confirm package selection provides sufficient isolation
- [ ] Verify production guidance is clear
- [ ] Test that credentials are still required

## Changes to Existing Features

None (all functionality identical, only security model changed).

## New Features

None (security model simplification only).

## Support

Report issues at: https://github.com/klemensms/mcp-consultant-tools/issues
