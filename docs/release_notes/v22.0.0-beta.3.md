# Release v22.0.0-beta.3

**Release Date:** TBD
**Type:** Major Release
**Status:** Beta Testing

## Overview

Version 22.0.0-beta.3 enhances the **Azure SQL zero-discovery workflow** with explicit anti-guessing guidance to prevent AI agents from hallucinating incorrect server/database values.

## Changes in beta.3

### Azure SQL Anti-Guessing Improvements

**Problem solved:** AI agents were guessing incorrect `serverId` values (e.g., inferring "scc-dev" from database name "sqldb-dev-aop-sc-uks-01") instead of omitting the parameter to use defaults.

#### Enhanced Tool Descriptions

All SQL tools now include explicit anti-guessing language:

**Main query tool:**
```
sql-execute-query:
‚ö†Ô∏è IMPORTANT: DO NOT GUESS serverId or database values. If you don't know them, OMIT THEM ENTIRELY.
The server has pre-configured defaults - just provide the query parameter and defaults will be applied automatically.
Example: sql-execute-query(query: "SELECT * FROM dbo.Users") - serverId and database omitted, defaults used.
```

**Parameter descriptions:**
```
serverId: ‚ö†Ô∏è OMIT unless switching servers. DO NOT GUESS - omitting uses the pre-configured default server.
database: ‚ö†Ô∏è OMIT unless switching databases. DO NOT GUESS - omitting uses the pre-configured default database.
```

**Discovery tools (sql-list-servers, sql-list-databases, sql-get-defaults):**
```
‚ö†Ô∏è SKIP THIS for most queries. You DO NOT need to call this before querying - defaults are automatic.
Only use this tool if: (1) you got an explicit error about server not found, OR (2) user specifically asks about available servers.
```

#### Improved Error Messages

When agents DO guess wrong, errors now explicitly suggest omitting:

```
Server 'scc-dev' not found. Available: [default].
üí° TIP: OMIT the serverId parameter entirely to use the default server 'default'. DO NOT GUESS server IDs.
```

```
Database 'wrong-db' not found on server 'default'. Available: [sqldb-dev-aop-sc-uks-01].
üí° TIP: OMIT the database parameter entirely to use the default database 'sqldb-dev-aop-sc-uks-01'. DO NOT GUESS database names.
```

### Expected Agent Behavior Change

**Before (3+ API calls):**
1. Agent sees `serverId` parameter ‚Üí hallucinates "scc-dev"
2. Gets error ‚Üí calls `sql-list-servers`
3. Discovers "default" ‚Üí calls `sql-list-databases`
4. Retries with correct values

**After (1 API call):**
1. Agent sees `‚ö†Ô∏è OMIT... DO NOT GUESS` ‚Üí omits parameter
2. Query succeeds using defaults
3. Response shows `‚ÑπÔ∏è Used defaults: server='default', database='...'`

## Beta Testing Configuration

### Azure SQL

```json
{
  "mcpServers": {
    "azure-sql": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/azure-sql@beta"],
      "env": {
        "AZURE_SQL_SERVER": "your-server.database.windows.net",
        "AZURE_SQL_DATABASE": "your-database",
        "AZURE_SQL_USERNAME": "your-username",
        "AZURE_SQL_PASSWORD": "your-password"
      }
    }
  }
}
```

## Beta Testing Checklist for beta.3

### Zero-Discovery Anti-Guessing

- [ ] **Agent omits parameters**: When asked to query SQL, agent should NOT guess serverId/database
  - Ask Claude: "Query the Users table" (don't mention server/database)
  - Verify agent calls `sql-execute-query(query: "SELECT * FROM Users")` without serverId/database
  - Verify response includes `‚ÑπÔ∏è Used defaults: server='...', database='...'`

- [ ] **Improved error messages**: When agent DOES guess wrong
  - Manually test: `sql-execute-query(serverId: "wrong", query: "SELECT 1")`
  - Verify error includes: `üí° TIP: OMIT the serverId parameter entirely...`

- [ ] **Discovery tools discouraged**: Agent should skip sql-list-servers/sql-list-databases
  - Ask Claude a multi-step task requiring SQL
  - Verify agent doesn't proactively call discovery tools
  - Verify agent only calls them if explicitly asked or after an error

### Backward Compatibility

- [ ] **Explicit parameters still work**:
  - `sql-execute-query(serverId: "default", database: "mydb", query: "SELECT 1")` should work
  - No change in behavior when parameters are provided

## Previous beta.1/beta.2 Changes

See [v22.0.0-beta.1.md](v22.0.0-beta.1.md) for:
- REST API Integration (6 tools, 2 prompts)
- OpenAPI auto-discovery for endpoint/schema listing
- Azure SQL zero-discovery enhancements (`sql-get-defaults` tool)
- Optional `serverId`/`database` parameters in all SQL tools

## Support

Report issues at: https://github.com/klemensms/mcp-consultant-tools/issues
