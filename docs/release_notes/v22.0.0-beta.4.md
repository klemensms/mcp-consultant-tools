# Release v22.0.0-beta.4

**Release Date:** TBD
**Type:** Major Release
**Status:** Beta Testing

## Overview

Version 22.0.0-beta.4 adds **Custom API and Action execution** to the PowerPlatform Data package, enabling AI agents to call both unbound (global) and bound (entity-specific) actions in Dataverse.

## Changes in beta.4

### PowerPlatform Data: Execute Action Tool

**New Feature:** Added `execute-action` tool to the `@mcp-consultant-tools/powerplatform-data` package.

#### Capabilities

- **Unbound Actions**: Execute global actions not tied to any entity (e.g., `WhoAmI`, custom APIs)
- **Bound Actions**: Execute entity-specific actions (e.g., `WinOpportunity`, `QualifyLead`)
- **Input Parameters**: Pass complex parameter objects to actions
- **Output Parameters**: Receive action response with output values
- **Audit Logging**: All action executions logged with timestamps and parameters

#### New Environment Variable

```bash
POWERPLATFORM_ENABLE_ACTIONS=true  # Enables execute-action tool
```

#### Tool: execute-action

**Parameters:**
- `actionName` (string, required): Action/Custom API name (e.g., `"WhoAmI"`, `"new_MyCustomAPI"`)
- `parameters` (object, optional): Input parameters as JSON
- `boundTo` (object, optional): For bound actions - `{ entityNamePlural, recordId }`

**Example - Unbound Action:**
```javascript
await invoke("execute-action", {
  actionName: "WhoAmI"
});
// Returns: { UserId: "guid", BusinessUnitId: "guid", OrganizationId: "guid" }
```

**Example - Bound Action:**
```javascript
await invoke("execute-action", {
  actionName: "WinOpportunity",
  parameters: {
    Status: 3,
    OpportunityClose: {
      subject: "Won - Deal closed",
      actualrevenue: 50000.00
    }
  },
  boundTo: {
    entityNamePlural: "opportunities",
    recordId: "12345678-1234-1234-1234-123456789012"
  }
});
```

#### Security Model

- Requires `POWERPLATFORM_ENABLE_ACTIONS=true` environment flag
- All executions logged to audit trail
- GUID validation for bound action record IDs
- Action must exist in Dataverse (validated by API)

### Updated Dependencies

- Updated `@mcp-consultant-tools/core` dependency from `^1.0.0` to `^20.0.0`
- Added `EXECUTE` operation type to audit logger

### Tool Count Update

PowerPlatform Data package now has **4 tools** (was 3):
- `create-record`
- `update-record`
- `delete-record`
- `execute-action` ‚Üê **NEW**

## Beta Testing Configuration

### PowerPlatform Data (with Actions)

```json
{
  "mcpServers": {
    "powerplatform-data": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/powerplatform-data@beta"],
      "env": {
        "POWERPLATFORM_URL": "https://yourenv.crm.dynamics.com",
        "POWERPLATFORM_CLIENT_ID": "your-client-id",
        "POWERPLATFORM_CLIENT_SECRET": "your-client-secret",
        "POWERPLATFORM_TENANT_ID": "your-tenant-id",
        "POWERPLATFORM_ENABLE_CREATE": "true",
        "POWERPLATFORM_ENABLE_UPDATE": "true",
        "POWERPLATFORM_ENABLE_DELETE": "true",
        "POWERPLATFORM_ENABLE_ACTIONS": "true"
      }
    }
  }
}
```

## Beta Testing Checklist for beta.4

### Execute Action Tool

- [ ] **Unbound action - WhoAmI**
  - Ask Claude: "Execute the WhoAmI action to get current user info"
  - Verify response includes `UserId`, `BusinessUnitId`, `OrganizationId`

- [ ] **Unbound action - Custom API**
  - If you have a custom API, test: "Execute new_MyCustomAPI with parameter X"
  - Verify input parameters are passed correctly
  - Verify output parameters are returned

- [ ] **Bound action - WinOpportunity** (if you have test data)
  - Create test opportunity in development environment
  - Ask Claude: "Close this opportunity as won"
  - Verify the bound action executes with correct entity/record binding

- [ ] **Permission denied without flag**
  - Remove `POWERPLATFORM_ENABLE_ACTIONS` from config
  - Try to execute an action
  - Verify error: "Action execution is disabled. Set POWERPLATFORM_ENABLE_ACTIONS=true to enable."

- [ ] **Invalid action name**
  - Try to execute non-existent action
  - Verify clear error message from Dataverse API

- [ ] **Audit logging**
  - Execute actions and verify audit log entries include:
    - `operation: 'execute-action'`
    - `operationType: 'EXECUTE'`
    - `componentType: 'Action'`
    - `executionTimeMs`

### Backward Compatibility

- [ ] **Existing CRUD tools still work**
  - Test `create-record`, `update-record`, `delete-record`
  - No regression in existing functionality

## Previous Beta Changes

See previous release notes for:
- [v22.0.0-beta.3](v22.0.0-beta.3.md) - Azure SQL anti-guessing improvements
- [v22.0.0-beta.1](v22.0.0-beta.1.md) - REST API Integration, Azure SQL zero-discovery

## Support

Report issues at: https://github.com/klemensms/mcp-consultant-tools/issues
