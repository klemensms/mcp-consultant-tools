# Release v22.0.0-beta.1

**Release Date:** TBD
**Type:** Major Release
**Status:** Beta Testing

## Overview

Version 22.0.0 introduces the **REST API Integration** - a new MCP server for testing HTTP endpoints with comprehensive authentication support, including automatic OAuth2 client credentials flow for JWT token generation. This release also includes significant **zero-discovery workflow enhancements** to reduce AI agent overhead when interacting with SQL and REST API services.

## Breaking Changes

None.

## New Features

### REST API Integration (`@mcp-consultant-tools/rest-api`)

**New Package:** A complete MCP server for REST API testing.

#### Key Capabilities

- **HTTP Methods**: Full support for GET, POST, PUT, DELETE, PATCH
- **OAuth2 Client Credentials**: Automatic JWT token acquisition with intelligent caching (5-minute refresh buffer)
- **Multiple Auth Methods**: OAuth2, static bearer, basic auth, API key
- **Response Management**: Configurable size limits with smart truncation
- **Batch Operations**: Execute multiple requests sequentially with optional stop-on-error
- **Custom Headers**: Configure persistent headers via `HEADER_*` environment variables
- **SSL Control**: Enable/disable certificate verification for development environments
- **OpenAPI Auto-Discovery**: Automatically discover all endpoints and schemas from your API's OpenAPI/Swagger spec (recommended for DAB)
- **Endpoint Discovery**: List available API endpoints without external documentation
- **Schema Lookup**: Get entity field definitions before creating/updating records

#### New Tools (6)

| Tool | Description |
|------|-------------|
| `rest-request` | Execute a single HTTP request with automatic authentication |
| `rest-config` | Get current service configuration summary |
| `rest-refresh-token` | Force refresh OAuth2 access token cache |
| `rest-batch-request` | Execute multiple requests sequentially |
| `rest-list-endpoints` | List all available API endpoints with supported methods |
| `rest-get-schema` | Get entity schema/field definitions for a specific entity |

#### New Prompts (2)

| Prompt | Description |
|--------|-------------|
| `rest-api-guide` | Comprehensive guide for using REST API testing tools |
| `rest-api-troubleshoot` | Troubleshooting guide for common issues |

#### Use Cases

- **Data API Builder (DAB) Testing**: Test Azure DAB APIs with automatic Entra ID authentication
- **API Development**: Test endpoints during development with configurable auth
- **Integration Testing**: Validate API workflows using batch requests
- **Troubleshooting**: Debug API issues with detailed request/response information
- **Zero-Discovery Workflows**: List endpoints and schemas without external docs

### Azure SQL Zero-Discovery Enhancements (`@mcp-consultant-tools/azure-sql`)

**Goal:** Reduce discovery overhead from 67% to 0% for common SQL workflows.

#### New Tool: `sql-get-defaults`

Returns the default/active server and database configuration, enabling agents to understand the SQL environment in a single call.

```json
{
  "defaultServerId": "default",
  "defaultServerName": "sqls-dev-aop-sc-uks-01.database.windows.net",
  "defaultDatabase": "sqldb-dev-aop-sc-uks-01",
  "serverCount": 1,
  "hint": "Single server configured. You can omit serverId and database parameters in queries."
}
```

#### Enhanced: Optional Parameters in `sql-execute-query`

The `serverId` and `database` parameters are now **optional**. When omitted, they default to:
- First active server in configuration
- First active database on that server

**Before (required 2 discovery calls):**
```
sql-list-servers → sql-list-databases → sql-execute-query(serverId, database, query)
```

**After (zero discovery calls):**
```
sql-execute-query(query="SELECT TOP 10 * FROM dbo.Users")
```

The tool automatically resolves defaults and includes a hint in the response showing which defaults were used.

## Changes to Existing Features

### Azure SQL Package

- **12 tools** (previously 11) - added `sql-get-defaults`
- **ALL tools now have optional `serverId` and `database` parameters** - agents can skip discovery entirely
- Tool descriptions updated to explicitly guide agents to skip `sql-list-servers` and `sql-list-databases` when using defaults
- All 3 prompts (`sql-database-overview`, `sql-table-details`, `sql-query-results`) also support optional parameters
- New service methods: `getDefaultConfiguration()`, `resolveServerId()`, `resolveDatabase()`

## Beta Testing Configuration

### REST API Integration

```json
{
  "mcpServers": {
    "rest-api": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/rest-api@beta"],
      "env": {
        "REST_BASE_URL": "https://your-api.example.com",
        "OAUTH2_TOKEN_URL": "https://login.microsoftonline.com/{tenant-id}/oauth2/v2.0/token",
        "OAUTH2_CLIENT_ID": "your-client-id",
        "OAUTH2_CLIENT_SECRET": "your-client-secret",
        "OAUTH2_SCOPE": "api://your-app-id/.default"
      }
    }
  }
}
```

### Without OAuth2 (Simple Bearer Token)

```json
{
  "mcpServers": {
    "rest-api": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/rest-api@beta"],
      "env": {
        "REST_BASE_URL": "https://httpbin.org",
        "AUTH_BEARER": "your-static-token"
      }
    }
  }
}
```

### Public API Testing (No Auth)

```json
{
  "mcpServers": {
    "rest-api": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/rest-api@beta"],
      "env": {
        "REST_BASE_URL": "https://httpbin.org"
      }
    }
  }
}
```

### With OpenAPI Auto-Discovery (for Data API Builder)

Point to your DAB's Swagger URL and all endpoints/schemas are auto-discovered.

```json
{
  "mcpServers": {
    "rest-api": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/rest-api@beta"],
      "env": {
        "REST_BASE_URL": "https://your-dab-api.azurewebsites.net/api",
        "OAUTH2_TOKEN_URL": "https://login.microsoftonline.com/{tenant-id}/oauth2/v2.0/token",
        "OAUTH2_CLIENT_ID": "your-client-id",
        "OAUTH2_CLIENT_SECRET": "your-client-secret",
        "OAUTH2_SCOPE": "api://your-app-id/.default",
        "REST_OPENAPI_URL": "https://your-dab-api.azurewebsites.net/swagger/v1/swagger.json"
      }
    }
  }
}
```

**Benefits:**
- Zero maintenance - schemas auto-update when your API changes
- Works with 80+ tables automatically
- No manual configuration needed

### Azure SQL with Optional Parameters

```json
{
  "mcpServers": {
    "azure-sql": {
      "command": "npx",
      "args": ["-y", "@mcp-consultant-tools/azure-sql@beta"],
      "env": {
        "AZURE_SQL_SERVER": "your-server.database.windows.net",
        "AZURE_SQL_DATABASE": "your-database",
        "AZURE_SQL_USERNAME": "your-username",
        "AZURE_SQL_PASSWORD": "your-password"
      }
    }
  }
}
```

## Beta Testing Checklist

### REST API Integration

- [ ] **Basic connectivity**: Server starts and responds to tool calls
  - Run `rest-config` to verify configuration is loaded
- [ ] **Public API test**: Test against httpbin.org (no auth required)
  - Run `rest-request` with `method: "GET"`, `endpoint: "/get"`
- [ ] **OAuth2 authentication**: Test with Azure AD protected API
  - Configure OAuth2 environment variables
  - Run `rest-request` and verify automatic token acquisition
  - Run `rest-refresh-token` and verify token cache is cleared
- [ ] **Batch operations**: Test multiple sequential requests
  - Run `rest-batch-request` with 2-3 requests
  - Test `stopOnError: true` behavior
- [ ] **Response truncation**: Verify large responses are properly truncated
  - Request endpoint returning large payload
  - Check `validation.truncated` in response
- [ ] **Error handling**: Verify errors are properly reported
  - Test 404, 401, 500 responses
  - Test connection errors (invalid host)
- [ ] **Host override**: Test `host` parameter for cross-server requests
  - Run `rest-request` with custom `host` parameter
- [ ] **Custom headers**: Test `HEADER_*` environment variables
  - Add custom header and verify it's sent
- [ ] **OpenAPI auto-discovery**: Test with Swagger/OpenAPI URL
  - Configure `REST_OPENAPI_URL` pointing to your API's swagger.json
  - Run `rest-list-endpoints` - should auto-discover all endpoints
  - Run `rest-list-endpoints` with filter parameter
  - Run `rest-get-schema` with entity name - should return schema from OpenAPI
  - Verify caching works (second call should be instant)

### Azure SQL Integration

- [ ] **Zero-discovery workflow**: Test optional parameters
  - Configure single server/database
  - Run `sql-execute-query` with only `query` parameter (no serverId/database)
  - Verify defaults are used and shown in response
- [ ] **Get defaults**: Test `sql-get-defaults` tool
  - Run `sql-get-defaults` and verify response includes hint
- [ ] **Explicit parameters still work**: Test backward compatibility
  - Run `sql-execute-query` with explicit serverId and database
  - Verify explicit values override defaults
- [ ] **Error handling**: Verify errors when defaults cannot be resolved
  - Test with discovery mode (empty databases array)
  - Verify helpful error message is returned

### Environment Variables to Test

| Variable | Description | Test Value |
|----------|-------------|------------|
| `REST_BASE_URL` | Base URL (required) | `https://httpbin.org` |
| `REST_OPENAPI_URL` | OpenAPI/Swagger URL | `https://your-api.com/swagger.json` |
| `REST_RESPONSE_SIZE_LIMIT` | Max response size | `5000` |
| `REST_ENABLE_SSL_VERIFY` | SSL verification | `false` (for self-signed) |
| `REST_TIMEOUT` | Request timeout | `10000` |
| `HEADER_*` | Custom headers | `HEADER_Accept=application/json` |
| `AZURE_SQL_SERVER` | SQL server hostname | `server.database.windows.net` |
| `AZURE_SQL_DATABASE` | Default database | `mydb` |

## Migration Notes

### From v21.x to v22.x

**No breaking changes.** All existing configurations continue to work.

**New optional configurations:**
- `REST_OPENAPI_URL` - Enable endpoint/schema discovery via OpenAPI
- Optional `serverId`/`database` in SQL queries - Existing calls with explicit parameters work unchanged

## Support

Report issues at: https://github.com/klemensms/mcp-consultant-tools/issues
